# Linux Process Information Kernel Module

[![CI](https://img.shields.io/github/actions/workflow/status/navidpadid/process-info-kernel-module/ci.yml?branch=main&style=for-the-badge&logo=github&logoColor=white&label=Build)](https://github.com/navidpadid/process-info-kernel-module/actions/workflows/ci.yml)
[![Last Commit](https://img.shields.io/github/last-commit/navidpadid/process-info-kernel-module?style=for-the-badge&logo=git&logoColor=white)](https://github.com/navidpadid/process-info-kernel-module/commits/main)
[![License](https://img.shields.io/badge/License-Dual%20BSD%2FGPL-blue?style=for-the-badge)](LICENSE)

> A Linux kernel module that extracts detailed process and it's thread information including memory layout, CPU usage, and ELF sections via `/proc` filesystem.

## Features

- **Process Memory Layout**: Code, Data, BSS, Heap, and Stack addresses
- **Visual Memory Map**: Proportional bar chart visualization of memory regions
- **Thread Information**: List all threads with TID, state, CPU usage, priority, and CPU affinity
- **CPU Usage Tracking**: Real-time CPU percentage calculation per process and thread
- **ELF Section Analysis**: Binary base address and section boundaries
- **Proc Interface**: Easy access through `/proc/elf_det/`
- **Comprehensive Testing**: Unit tests and QEMU-based E2E testing
- **Code Quality**: Pre-configured static analysis (sparse, cppcheck, checkpatch)

### Example Output

```
>> Enter process ID (or Ctrl+C to exit): 3115

================================================================================
                          PROCESS INFORMATION                                   
================================================================================
Command line:   ./build/test_multithread 
Process ID:      3115
Name:            test_multithrea
CPU Usage:       2.06%

Memory Layout:
--------------------------------------------------------------------------------
  Code Section:    0x0000643f5b8f5000 - 0x0000643f5b8f5459
  Data Section:    0x0000643f5b8f7d78 - 0x0000643f5b8f8010
  BSS Section:     0x0000643f5b8f8010 - 0x0000643f87d3b000
  Heap:            0x0000643f87d3b000 - 0x0000643f87d5c000
  Stack:           0x00007ffcdf141220 - 0x00007ffcdf121000
  ELF Base:        0x0000643f5b8f4000

Memory Layout Visualization:
--------------------------------------------------------------------------------
Low:  0x0000643f5b8f5000

CODE  (1 KB)
      [=                                                 ]

DATA  (664 B)
      [=                                                 ]

BSS   (708 MB)
      [================================================= ]

HEAP  (132 KB)
      [=                                                 ]

STACK (128 KB)
      [=                                                 ]

High: 0x00007ffcdf141220
--------------------------------------------------------------------------------

================================================================================
                          THREAD INFORMATION                                    
================================================================================
TID    NAME             CPU(%)   STATE  PRIORITY  NICE  CPU_AFFINITY
-----  ---------------  -------  -----  --------  ----  ----------------
3115   test_multithrea     2.06   S         0         0  0,1
3117   test_multithrea     0.32   S         0         0  0,1
3118   test_multithrea     0.29   S         0         0  0,1
3119   test_multithrea     0.26   S         0         0  0,1
3120   test_multithrea     0.14   S         0         0  0,1
--------------------------------------------------------------------------------
```

## Quick Start

### Prerequisites

- **Docker** + **VS Code** with Remote - Containers extension
- Dev container includes everything: Ubuntu 24.04, kernel 6.8+ headers, build tools, static analysis

### Build and Run

1. Open project in VS Code → "Reopen in Container"
2. Build:
   ```bash
   make all
   ```
3. Install module:
   ```bash
   sudo make install
   ```
4. Run user program:
   ```bash
   ./build/proc_elf_ctrl
   ```

### Uninstall the Module

```bash
sudo make uninstall
```

## Project Structure

```
kernel_module/
├── .devcontainer/      # Dev container config (Docker + VS Code setup)
├── .github/            # CI/CD workflows (GitHub Actions)
├── docs/               # Detailed documentation
├── e2e/                # End-to-end testing scripts (QEMU setup, automation)
├── src/                # Source code (kernel module, user program, tests, helpers)
├── build/              # Build artifacts (generated by make)
└── Makefile            # Build system with quality checks
```

**Notes**: 
- **Memory Visualization**: Each region's bar length is proportional to its actual size
- Sizes are automatically displayed in appropriate units (B, KB, or MB)
- Low/High addresses show the memory address range of the process
- BSS_START and BSS_END may be equal (zero-length BSS) in modern ELF binaries. This is normal.
- Thread STATE: R=Running, S=Sleeping, D=Uninterruptible, T=Stopped, t=Traced, Z=Zombie, X=Dead
- PRIORITY: Shown as nice value (-20 to 19, where lower is higher priority)
- CPU_AFFINITY: Shows which CPUs the thread can run on



## Safe Testing with QEMU

For maximum safety, test the kernel module in an isolated QEMU virtual machine that won't affect your host system.

### Quick Start

```bash
# One-time setup
./e2e/qemu-setup.sh

# Start VM
./e2e/qemu-run.sh

# In another terminal, run automated tests
./e2e/qemu-test.sh
```


## Makefile Targets

```bash
make all              # Build kernel module and user program
make module           # Build kernel module only
make user             # Build user program only
make test-multithread # Build multi-threaded test program
make install          # Install kernel module (requires root)
make uninstall        # Remove kernel module
make unit             # Run unit tests (no kernel required)
make test             # Install module and run user program

make format           # Format all source files
make format-check     # Check formatting (CI-friendly)
make check            # Run all static analysis
make checkpatch        # Check kernel coding style
make sparse           # Run sparse static analyzer
make cppcheck         # Run cppcheck static analyzer
make clean            # Remove build artifacts
make help             # Show help message
```

## Testing

### Unit Tests (Recommended First)
```bash
make unit
```
Runs pure function tests without kernel dependencies.

### QEMU Testing (Safe Kernel Testing)
```bash
./e2e/qemu-setup.sh    # One-time setup
./e2e/qemu-run.sh      # Start VM
./e2e/qemu-test.sh     # Run automated tests
```

See [docs/TESTING.md](docs/TESTING.md) for detailed testing documentation.

## Documentation

- [TESTING.md](docs/TESTING.md) - Unit tests, QEMU testing, troubleshooting
- [TECHNICAL.md](docs/TECHNICAL.md) - Kernel module details, memory layout, limitations
- [CODE_QUALITY.md](docs/CODE_QUALITY.md) - Static analysis, code formatting, best practices
- [SCRIPTS.md](docs/SCRIPTS.md) - Detailed script documentation
- [RELEASE.md](docs/RELEASE.md) - Version release process and guidelines

## License

Dual BSD/GPL - Choose the license that works best for you:
- **GPL**: Required for Linux kernel compatibility
- **BSD**: Permissive for other uses

## Contributing

Contributions welcome! The project includes:
- Pre-configured dev container
- Automated testing (unit tests + QEMU E2E)
- Static analysis and formatting tools
- GitHub Actions CI/CD

---

**Educational Project**: Demonstrates Linux kernel module development. Use at your own risk.

### Configuration Files

- `.clang-format` - clang-format configuration (Linux kernel style)
- `.cppcheck-suppressions` - Suppression list for false positives
- `.editorconfig` - Editor configuration for consistent coding style

### Static Analysis Tools

#### checkpatch.pl
Official Linux kernel coding style checker. Enforces kernel coding standards including:
- Indentation and spacing rules
- Line length limits
- Function declaration style
- Comment formatting
- Macro usage patterns

#### sparse
Semantic parser specifically designed for kernel code. Detects:
- Type confusion errors
- Endianness issues
- Lock context imbalances
- Address space mismatches
- Null pointer dereferences

#### cppcheck
General-purpose C/C++ static analyzer. Finds:
- Memory leaks
- Buffer overflows
- Uninitialized variables
- Dead code
- Logic errors

#### clang-format
Code formatter that ensures consistent style:
- 8-space tabs (kernel standard)
- 80-column limit
- Linux brace style
- Proper spacing and alignment

## Testing

The module has been tested on:
- Ubuntu 20.04 LTS (Kernel 5.15+)
- Ubuntu 22.04 LTS (Kernel 5.19+)
- Ubuntu 24.04 LTS (Kernel 6.8+)

**Kernel Compatibility Notes:**
- Kernel 5.6+ required (proc_ops API)
- Kernel 6.8+ recommended (VMA iterator API)
- The code has been updated to use modern kernel APIs including VMA iterators and proc_ops**Educational Project**: Demonstrates Linux kernel module development. Use at your own risk.
